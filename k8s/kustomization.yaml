# ============================================
# Kustomize Configuration for PayFlow
# ============================================
# Purpose: Manifest bundling for ArgoCD GitOps
# Usage: kubectl apply -k k8s/
# Or let ArgoCD sync this automatically

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: payflow

resources:
  # Namespaces
  - namespace.yaml
  - monitoring-namespace.yaml
  - argocd-namespace.yaml
  
  # ArgoCD Configuration
  - argocd/argocd-configmap.yaml
  - argocd/argocd-certificate-issuer.yaml
  
  # Secrets and ConfigMaps
  - secrets/db-secrets.yaml
  # Cloudflare tunnel secret (contains sensitive token - not in kustomization by default)
  # Apply manually: kubectl apply -f secrets/cloudflare-tunnel-secret.yaml
  - configmaps/app-config.yaml
  
  # Infrastructure
  - statefulsets/postgres.yaml
  - deployments/rabbitmq.yaml
  - deployments/redis.yaml
  
  # Application Services
  - deployments/api-gateway.yaml
  - deployments/auth-service.yaml
  - deployments/wallet-service.yaml
  - deployments/transaction-service.yaml
  - deployments/notification-service.yaml
  - deployments/frontend.yaml
  - deployments/cloudflare-tunnel.yaml
  
  # Jobs
  - jobs/db-migration.yaml
  - jobs/transaction-timeout.yaml
  
  # Ingress
  - ingress/tls-ingress.yaml
  - ingress/monitoring-ingress.yaml
  - ingress/argocd-ingress.yaml
  
  # Production Policies
  - policies/pod-disruption-budgets.yaml
  - policies/resource-quotas.yaml
  # Network policies disabled by default (can be enabled when needed)
  # - policies/network-policies.yaml
  
  # Autoscaling
  - autoscaling/hpa-config.yaml
  
  # Backups
  - backups/postgres-backup-cronjob.yaml
  
  # Security
  - security/image-scanning-cronjob.yaml
  
  # Monitoring
  - monitoring/prometheus-config.yaml
  - monitoring/prometheus-deployment.yaml
  - monitoring/grafana-datasources.yml
  # grafana-dashboard-config.yaml removed - merged into grafana-dashboards.yaml
  # The grafana-dashboards.yaml file contains both:
  # 1. grafana-dashboard-provider (provider config)
  # 2. grafana-dashboards (dashboard JSON)
  - monitoring/grafana-dashboards.yaml
  - monitoring/grafana-deployment.yaml

